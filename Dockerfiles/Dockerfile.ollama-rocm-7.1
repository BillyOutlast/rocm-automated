FROM docker.io/getterup/fedora-rocm7.1:latest
# vim: filetype=dockerfile

# Copy built ollama binary and libraries from build output
COPY ollama-build/ollama-build-output/bin/ollama /usr/bin/ollama
COPY ollama-build/ollama-build-output/lib/ollama /usr/lib/ollama

# Set executable permissions
RUN chmod +x /usr/bin/ollama


# ROCm environment variables for runtime
ENV ROCM_PATH=/opt/rocm \
    HIP_PATH=/opt/rocm \
    HIP_CLANG_PATH=/opt/rocm/llvm/bin \
    HIP_DEVICE_LIB_PATH=/opt/rocm/amdgcn/bitcode \
    PATH=/opt/rocm/bin:/opt/rocm/llvm/bin:$PATH

# Set up library paths and environment
ENV LD_LIBRARY_PATH=/opt/rocm/lib:/usr/lib/ollama:/usr/lib/ollama/rocm:$LD_LIBRARY_PATH 

# Expose port
EXPOSE 11434

ENTRYPOINT ["/usr/bin/ollama", "serve"]